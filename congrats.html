<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Congratulations!</title>
    <link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Pixelify Sans', sans-serif;
            color: white;
            background-color: #0a0a0a;
            font-size: 22px;
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            opacity: 0; /* Start with opacity 0 */
            transition: opacity 1.5s ease-in; /* Smooth transition effect */
        }

        /* Full-screen background image */
        .bg-image {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('images/c_normal.png');
            background-size: cover;
            background-position: center;
            z-index: -1;
        }

        /* Big congratulations text */
        .congrats-text {
            position: fixed;
            top: 80px;
            left: 120px;
            font-size: 120px;
            font-weight: bold;
            color: #f3f03f;
            text-shadow: 3px 3px 5px rgba(0, 0, 0, 0.7);
            z-index: 5;
            transform: rotate(-5deg);
            animation: pulse 3s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1) rotate(-5deg); }
            50% { transform: scale(1.05) rotate(-5deg); }
            100% { transform: scale(1) rotate(-5deg); }
        }

        /* Dialogue box styling */
        #dialogue-container {
            background-color: rgba(0, 0, 0, 0.8);
            border: 2px solid white;
            width: 40%;
            max-width: 500px;
            padding: 20px;
            margin-left: 200px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
        }

        #dialogue {
            position: relative;
        }

        #dialogue-text {
            line-height: 1.5;
            max-height: 60vh; /* Maximum height limited to 60% of viewport height */
            overflow-y: auto; /* Add scrollbar if content exceeds max-height */
            padding-right: 5px; /* Space for scrollbar */
        }

        /* Custom scrollbar styling */
        #dialogue-text::-webkit-scrollbar {
            width: 5px;
        }

        #dialogue-text::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        #dialogue-text::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 10px;
        }

        #dialogue-timestamp {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 10px;
        }
        
        h2 {
            margin-top: 0;
            color: #AB1791;
        }

        .btn {
            background-color: #0D0D0D;
            color: white;
            border: 2px solid white;
            padding: 10px 20px;
            margin-top: 15px;
            cursor: pointer;
            font-family: 'Pixelify Sans', sans-serif;
            font-size: 18px;
        }

        .btn:hover {
            background-color: white;
            color: #0D0D0D;
        }

        .hidden {
            display: none;
        }

        /* Full screen message styling */
        #full-screen-message {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            z-index: 20;
            opacity: 0;
            transition: opacity 1s ease-in;
            pointer-events: none;
        }

        #final-message-text {
            font-size: 48px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            margin-left: 200px;
            max-width: 700px;
            text-align: left;
        }

        .fade-out {
            opacity: 0 !important;
            transition: opacity 1s ease-out;
        }
    </style>
</head>
<body>
    <div class="bg-image"></div>
    <div class="congrats-text">✧CONGRATULATIONS!✧</div>
    <audio id="horn-sound" src="horn.mp3"></audio>
    <div id="dialogue-container">
        <div id="dialogue-timestamp"></div>
        <div id="dialogue">
            <h2>Cyrus:</h2>
            <p id="dialogue-text"></p>
        </div>
        <button id="next-btn" class="btn hidden">Next</button>
        <button id="back-btn" class="btn hidden" onclick="window.location.href='testing.html'">Go Back</button>
    </div>

    <div id="full-screen-message">
        <div id="final-message-text"></div>
    </div>

    <audio id="horn-sound" src="horn.mp3"></audio>
    <audio id="typing-sound" src="typing.mp3"></audio>

    <script>
        // Messages to display in sequence
        const congratsMessages = [
            "Well done! You've found the password!",
            "I hope it wasn't too difficult to find. Honestly i don't know if its hard or not.",
            "I tried to make the challenge interesting by making this website and the inventory stuff.. which is kinda out of place",
            "Anyways, congratulations on completing this challenge! You've done well, Praktikan Sisop.",
            "I just hope you didn't cheat by looking someone's code or finding this website by looking at the source code.",
            "This is the end of the line for now. Maybe we'll meet again in another module? If i'm not lazy that is."
        ];
        
        // Images to display for each message
        const backgroundImages = [
            'images/c_normal.png',
            'images/c_open.png',
            'images/c_smug.png',
            'images/c_open.png',
            'images/c_smug.png',
            'images/c_open.png'
        ];
        
        // Final message to be displayed on full screen
        const finalMessage = "Until next time, take care!";
        const finalImage = 'images/c_normal.png';

        let currentMessageIndex = 0;
        let typingEffect;
        
        // Function to update timestamp
        function updateTimestamp() {
            const timestampElement = document.getElementById("dialogue-timestamp");
            if (timestampElement) {
                const now = new Date();
                const formattedTime = now.toLocaleString("en-US", {
                    weekday: "long",
                    year: "numeric",
                    month: "short",
                    day: "numeric",
                    hour: "2-digit",
                    minute: "2-digit",
                    second: "2-digit"
                });
                timestampElement.innerHTML = formattedTime;
            }
        }

        // Function for typing animation
        function typeText(text, element = document.getElementById("dialogue-text"), callback = null) {
            element.innerHTML = "";
            let i = 0;
            let lastPlayedTime = 0;
            
            clearTimeout(typingEffect);
            
            function typeNext() {
                if (i < text.length) {
                    if (text.substring(i, i + 3) === "<a ") {
                        let endIndex = text.indexOf("</a>", i) + 4;
                        element.innerHTML += text.substring(i, endIndex);
                        i = endIndex;
                    } else {
                        element.innerHTML += text[i];
                        
                        let now = Date.now();
                        if (text[i] !== " " && now - lastPlayedTime > 50) {
                            let typingSound = document.getElementById("typing-sound");
                            typingSound.currentTime = 0.05;
                            typingSound.play();
                            lastPlayedTime = now;
                        }
                        
                        i++;
                    }
                    typingEffect = setTimeout(typeNext, element === document.getElementById("dialogue-text") ? 20 : 100); // Slower typing for final message
                } else {
                    // Show next button when typing is complete
                    if (currentMessageIndex < congratsMessages.length - 1) {
                        document.getElementById("next-btn").classList.remove("hidden");
                    } else if (currentMessageIndex === congratsMessages.length - 1) {
                        showFinalMessage();
                    } else {
                        document.getElementById("back-btn").classList.remove("hidden");
                    }
                    
                    if (callback) {
                        callback();
                    }
                }
            }
            
            typeNext();
        }

        let finalMessageTyped = false; // Flag to prevent retyping

        function showFinalMessage() {
            if (finalMessageTyped) return; // Prevent repeated execution

            finalMessageTyped = true; // Set flag to true

            // Fade out the dialogue box
            document.getElementById("dialogue-container").classList.add("fade-out");

            // Wait for fade-out to complete
            setTimeout(() => {
                // Hide dialogue box
                document.getElementById("dialogue-container").style.display = "none";

                // Change background to final image
                document.querySelector('.bg-image').style.backgroundImage = `url('${finalImage}')`;

                // Show full-screen message container
                const fullScreenMsg = document.getElementById("full-screen-message");
                fullScreenMsg.style.opacity = "1";

                // Type the final message slowly only once
                typeText(finalMessage, document.getElementById("final-message-text"), function () {
                    const backBtn = document.getElementById("back-btn");
                    backBtn.classList.remove("hidden");
                    backBtn.style.position = "fixed";
                    backBtn.style.bottom = "30px";
                    backBtn.style.left = "50%";
                    backBtn.style.transform = "translateX(-50%)";
                    backBtn.style.zIndex = "25";
                    document.body.appendChild(backBtn);
                });
            }, 1000);
        }

        // Function to show next message
        function showNextMessage() {
            document.getElementById("next-btn").classList.add("hidden");
            currentMessageIndex++;
            if (currentMessageIndex < congratsMessages.length) {
                // Change background image
                document.querySelector('.bg-image').style.backgroundImage = `url('${backgroundImages[currentMessageIndex]}')`;
                
                typeText(congratsMessages[currentMessageIndex]);
                updateTimestamp();
            } else {
                // This branch is now handled in typeText function
            }
        }

        // Initialize page
        document.addEventListener("DOMContentLoaded", function() {
            // Play horn sound when page loads
            const hornSound = document.getElementById("horn-sound");
            
            // Set volume to 50%
            hornSound.volume = 0.5;
            
            // Try to play the sound immediately on page load
            hornSound.play().catch(error => {
                console.log("Autoplay blocked:", error);
                
                // Fallback to play on first interaction with the page (any click)
                document.addEventListener('click', function playOnFirstClick() {
                    hornSound.play();
                    // Remove the event listener after first click
                    document.removeEventListener('click', playOnFirstClick);
                }, { once: true });
            });
            
            setTimeout(function() {
                document.body.style.opacity = 1;
            }, 100);
            
            updateTimestamp();
            setInterval(updateTimestamp, 1000);
            
            // Set initial background image
            document.querySelector('.bg-image').style.backgroundImage = `url('${backgroundImages[0]}')`;
            
            // Start with first message after fade-in completes
            setTimeout(function() {
                typeText(congratsMessages[0]);
            }, 800);
            
            // Set up next button event
            document.getElementById("next-btn").addEventListener("click", showNextMessage);
        });
    </script>
</body>
</html>
